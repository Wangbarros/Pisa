mltools::mcc(res_df$RF,res_df$Target)
load("~/Dropbox/PostDoc/Karolinska/Sapient/Results/future_prediction_2025-10-31-21-44.RData")
note <- reslist_n_rep$note
reslist_n_rep$note = NULL
note
res_df = data.frame(RF = character(), better_prob = character(), equal_worse_prob = character(),
Elastic = character(), Target = character())
RF_df = data.frame(mtry = character(), split = character(), min_node = character())
elastic_df = data.frame(alpha = character(), lambda = character())
i=1
reslist_n_rep[[15]]$rf_res$best_mtry
reslist_n_rep[[15]]$rf_res$probabilities_one
reslist_n_rep[[i]]$elastic_res$best_l1_l2
# a = (caret::varImp(rf_res$model))
# imp_df = a$importance
# setwd("~/Downloads")
# write.csv(imp_df, file='metabolites_imp_all.csv')
#setwd("~/Documents/1) Postdoc data/Karolinska/Sapient")
#final_df = read.csv('8m_rlc_imputted_rows.csv')
pfun <- function(object, newdata) {
predict(object, newdata = newdata, type = "prob")[,1] # prob of first class
}
# Approximate SHAP values (nsim controls accuracy vs. speed)
shap_values <- fastshap::explain(rf_res$model, X = df, pred_wrapper = pfun, nsim = 100)
# Variable importance = mean absolute SHAP
shap_importance <- sort(colMeans(abs(shap_values)), decreasing = TRUE)
for (i in 1:length(reslist_n_rep)){
res_df[i,1] = as.character(reslist_n_rep[[i]]$rf_res$prediction_one)
res_df[i,2] = as.character(reslist_n_rep[[i]]$rf_res$probabilities_one$Better)
res_df[i,3] = as.character(reslist_n_rep[[i]]$rf_res$probabilities_one$Equal.Worse)
# res_df[i,2] = as.character(reslist_n_rep[[i]]$rf_res$probabilities_one$Mild)
# res_df[i,3] = as.character(reslist_n_rep[[i]]$rf_res$probabilities_one$Moderate)
# res_df[i,4] = as.character(reslist_n_rep[[i]]$rf_res$probabilities_one$Severe)
# res_df[i,5] = as.character(reslist_n_rep[[i]]$elastic_res$prediction_one)
# res_df[i,6] = as.character(reslist_n_rep[[i]]$rf_res$target_one)
#
res_df[i,4] = as.character(reslist_n_rep[[i]]$elastic_res$prediction_one)
res_df[i,5] = as.character(reslist_n_rep[[i]]$rf_res$target_one)
RF_df[i,] = reslist_n_rep[[i]]$rf_res$best_mtry
elastic_df[i,] = reslist_n_rep[[i]]$elastic_res$best_l1_l2
}
table(res_df$RF, res_df$Target)
table(res_df$Elastic, res_df$Target)
table(res_df$Elastic, res_df$RF)
note
MLmetrics::Accuracy(res_df$RF,res_df$Target)
load("~/Dropbox/PostDoc/Karolinska/Sapient/Results/future_prediction_2025-10-30-20-00.RData")
note <- reslist_n_rep$note
reslist_n_rep$note = NULL
note
load("~/Dropbox/PostDoc/Karolinska/Sapient/Results/future_prediction_2025-11-03-13-16.RData")
note <- reslist_n_rep$note
reslist_n_rep$note = NULL
note
res_df = data.frame(RF = character(), better_prob = character(), equal_worse_prob = character(),
Elastic = character(), Target = character())
RF_df = data.frame(mtry = character(), split = character(), min_node = character())
elastic_df = data.frame(alpha = character(), lambda = character())
i=1
reslist_n_rep[[15]]$rf_res$best_mtry
reslist_n_rep[[15]]$rf_res$probabilities_one
reslist_n_rep[[i]]$elastic_res$best_l1_l2
# a = (caret::varImp(rf_res$model))
# imp_df = a$importance
# setwd("~/Downloads")
# write.csv(imp_df, file='metabolites_imp_all.csv')
#setwd("~/Documents/1) Postdoc data/Karolinska/Sapient")
#final_df = read.csv('8m_rlc_imputted_rows.csv')
pfun <- function(object, newdata) {
predict(object, newdata = newdata, type = "prob")[,1] # prob of first class
}
# Approximate SHAP values (nsim controls accuracy vs. speed)
shap_values <- fastshap::explain(rf_res$model, X = df, pred_wrapper = pfun, nsim = 100)
# Variable importance = mean absolute SHAP
shap_importance <- sort(colMeans(abs(shap_values)), decreasing = TRUE)
for (i in 1:length(reslist_n_rep)){
res_df[i,1] = as.character(reslist_n_rep[[i]]$rf_res$prediction_one)
res_df[i,2] = as.character(reslist_n_rep[[i]]$rf_res$probabilities_one$Better)
res_df[i,3] = as.character(reslist_n_rep[[i]]$rf_res$probabilities_one$Equal.Worse)
# res_df[i,2] = as.character(reslist_n_rep[[i]]$rf_res$probabilities_one$Mild)
# res_df[i,3] = as.character(reslist_n_rep[[i]]$rf_res$probabilities_one$Moderate)
# res_df[i,4] = as.character(reslist_n_rep[[i]]$rf_res$probabilities_one$Severe)
# res_df[i,5] = as.character(reslist_n_rep[[i]]$elastic_res$prediction_one)
# res_df[i,6] = as.character(reslist_n_rep[[i]]$rf_res$target_one)
#
res_df[i,4] = as.character(reslist_n_rep[[i]]$elastic_res$prediction_one)
res_df[i,5] = as.character(reslist_n_rep[[i]]$rf_res$target_one)
RF_df[i,] = reslist_n_rep[[i]]$rf_res$best_mtry
elastic_df[i,] = reslist_n_rep[[i]]$elastic_res$best_l1_l2
}
table(res_df$RF, res_df$Target)
table(res_df$Elastic, res_df$Target)
table(res_df$Elastic, res_df$RF)
note
MLmetrics::Accuracy(res_df$RF,res_df$Target)
MLmetrics::F1_Score(res_df$RF,res_df$Target)
mltools::mcc(res_df$RF,res_df$Target)
load("~/Dropbox/PostDoc/Karolinska/Sapient/Results/future_prediction_2025-11-03-13-50.RData")
note <- reslist_n_rep$note
reslist_n_rep$note = NULL
note
res_df = data.frame(RF = character(), better_prob = character(), equal_worse_prob = character(),
Elastic = character(), Target = character())
RF_df = data.frame(mtry = character(), split = character(), min_node = character())
elastic_df = data.frame(alpha = character(), lambda = character())
i=1
reslist_n_rep[[15]]$rf_res$best_mtry
reslist_n_rep[[15]]$rf_res$probabilities_one
reslist_n_rep[[i]]$elastic_res$best_l1_l2
# a = (caret::varImp(rf_res$model))
# imp_df = a$importance
# setwd("~/Downloads")
# write.csv(imp_df, file='metabolites_imp_all.csv')
#setwd("~/Documents/1) Postdoc data/Karolinska/Sapient")
#final_df = read.csv('8m_rlc_imputted_rows.csv')
pfun <- function(object, newdata) {
predict(object, newdata = newdata, type = "prob")[,1] # prob of first class
}
# Approximate SHAP values (nsim controls accuracy vs. speed)
shap_values <- fastshap::explain(rf_res$model, X = df, pred_wrapper = pfun, nsim = 100)
# Variable importance = mean absolute SHAP
shap_importance <- sort(colMeans(abs(shap_values)), decreasing = TRUE)
for (i in 1:length(reslist_n_rep)){
res_df[i,1] = as.character(reslist_n_rep[[i]]$rf_res$prediction_one)
res_df[i,2] = as.character(reslist_n_rep[[i]]$rf_res$probabilities_one$Better)
res_df[i,3] = as.character(reslist_n_rep[[i]]$rf_res$probabilities_one$Equal.Worse)
# res_df[i,2] = as.character(reslist_n_rep[[i]]$rf_res$probabilities_one$Mild)
# res_df[i,3] = as.character(reslist_n_rep[[i]]$rf_res$probabilities_one$Moderate)
# res_df[i,4] = as.character(reslist_n_rep[[i]]$rf_res$probabilities_one$Severe)
# res_df[i,5] = as.character(reslist_n_rep[[i]]$elastic_res$prediction_one)
# res_df[i,6] = as.character(reslist_n_rep[[i]]$rf_res$target_one)
#
res_df[i,4] = as.character(reslist_n_rep[[i]]$elastic_res$prediction_one)
res_df[i,5] = as.character(reslist_n_rep[[i]]$rf_res$target_one)
RF_df[i,] = reslist_n_rep[[i]]$rf_res$best_mtry
elastic_df[i,] = reslist_n_rep[[i]]$elastic_res$best_l1_l2
}
table(res_df$RF, res_df$Target)
table(res_df$Elastic, res_df$Target)
table(res_df$Elastic, res_df$RF)
note
MLmetrics::Accuracy(res_df$RF,res_df$Target)
load("~/Dropbox/PostDoc/Karolinska/Sapient/Results/future_prediction_2025-11-03-13-57.RData")
#####
#load("~/Dropbox/PostDoc/Karolinska/Sapient/Results/all_future_prediction_2025-08-26-10-46.RData")
#df = read.csv("future_data_imputted_final.csv")
#df$X = NULL
#df$target = NULL
note <- reslist_n_rep$note
reslist_n_rep$note = NULL
note
#res_df = data.frame(RF = character(),
#                    Elastic = character(), Target = character())
res_df = data.frame(RF = character(), better_prob = character(), equal_worse_prob = character(),
Elastic = character(), Target = character())
#res_df = data.frame(RF = character(), Mild_prob = character(), Moderate_prob = character(),
#                    Severe_prob = character(),
#                    Elastic = character(), Target = character())
RF_df = data.frame(mtry = character(), split = character(), min_node = character())
elastic_df = data.frame(alpha = character(), lambda = character())
i=1
reslist_n_rep[[15]]$rf_res$best_mtry
reslist_n_rep[[15]]$rf_res$probabilities_one
reslist_n_rep[[i]]$elastic_res$best_l1_l2
# a = (caret::varImp(rf_res$model))
# imp_df = a$importance
# setwd("~/Downloads")
# write.csv(imp_df, file='metabolites_imp_all.csv')
#setwd("~/Documents/1) Postdoc data/Karolinska/Sapient")
#final_df = read.csv('8m_rlc_imputted_rows.csv')
pfun <- function(object, newdata) {
predict(object, newdata = newdata, type = "prob")[,1] # prob of first class
}
# Approximate SHAP values (nsim controls accuracy vs. speed)
shap_values <- fastshap::explain(rf_res$model, X = df, pred_wrapper = pfun, nsim = 100)
load("~/Dropbox/PostDoc/Karolinska/Sapient/Results/future_prediction_2025-11-03-13-57.RData")
#####
#load("~/Dropbox/PostDoc/Karolinska/Sapient/Results/all_future_prediction_2025-08-26-10-46.RData")
#df = read.csv("future_data_imputted_final.csv")
#df$X = NULL
#df$target = NULL
note <- reslist_n_rep$note
reslist_n_rep$note = NULL
note
#res_df = data.frame(RF = character(),
#                    Elastic = character(), Target = character())
res_df = data.frame(RF = character(), better_prob = character(), equal_worse_prob = character(),
Elastic = character(), Target = character())
#res_df = data.frame(RF = character(), Mild_prob = character(), Moderate_prob = character(),
#                    Severe_prob = character(),
#                    Elastic = character(), Target = character())
RF_df = data.frame(mtry = character(), split = character(), min_node = character())
elastic_df = data.frame(alpha = character(), lambda = character())
i=1
reslist_n_rep[[15]]$rf_res$best_mtry
reslist_n_rep[[15]]$rf_res$probabilities_one
reslist_n_rep[[i]]$elastic_res$best_l1_l2
# a = (caret::varImp(rf_res$model))
# imp_df = a$importance
# setwd("~/Downloads")
# write.csv(imp_df, file='metabolites_imp_all.csv')
#setwd("~/Documents/1) Postdoc data/Karolinska/Sapient")
#final_df = read.csv('8m_rlc_imputted_rows.csv')
pfun <- function(object, newdata) {
predict(object, newdata = newdata, type = "prob")[,1] # prob of first class
}
# Approximate SHAP values (nsim controls accuracy vs. speed)
shap_values <- fastshap::explain(rf_res$model, X = df, pred_wrapper = pfun, nsim = 100)
load("~/Dropbox/PostDoc/Karolinska/Sapient/Results/future_prediction_2025-11-03-13-57.RData")
note <- reslist_n_rep$note
reslist_n_rep$note = NULL
note
res_df = data.frame(RF = character(), better_prob = character(), equal_worse_prob = character(),
Elastic = character(), Target = character())
RF_df = data.frame(mtry = character(), split = character(), min_node = character())
elastic_df = data.frame(alpha = character(), lambda = character())
i=1
reslist_n_rep[[15]]$rf_res$best_mtry
reslist_n_rep[[15]]$rf_res$probabilities_one
reslist_n_rep[[i]]$elastic_res$best_l1_l2
# a = (caret::varImp(rf_res$model))
# imp_df = a$importance
# setwd("~/Downloads")
# write.csv(imp_df, file='metabolites_imp_all.csv')
#setwd("~/Documents/1) Postdoc data/Karolinska/Sapient")
#final_df = read.csv('8m_rlc_imputted_rows.csv')
pfun <- function(object, newdata) {
predict(object, newdata = newdata, type = "prob")[,1] # prob of first class
}
# Approximate SHAP values (nsim controls accuracy vs. speed)
shap_values <- fastshap::explain(rf_res$model, X = df, pred_wrapper = pfun, nsim = 100)
# Variable importance = mean absolute SHAP
shap_importance <- sort(colMeans(abs(shap_values)), decreasing = TRUE)
for (i in 1:length(reslist_n_rep)){
res_df[i,1] = as.character(reslist_n_rep[[i]]$rf_res$prediction_one)
res_df[i,2] = as.character(reslist_n_rep[[i]]$rf_res$probabilities_one$Better)
res_df[i,3] = as.character(reslist_n_rep[[i]]$rf_res$probabilities_one$Equal.Worse)
# res_df[i,2] = as.character(reslist_n_rep[[i]]$rf_res$probabilities_one$Mild)
# res_df[i,3] = as.character(reslist_n_rep[[i]]$rf_res$probabilities_one$Moderate)
# res_df[i,4] = as.character(reslist_n_rep[[i]]$rf_res$probabilities_one$Severe)
# res_df[i,5] = as.character(reslist_n_rep[[i]]$elastic_res$prediction_one)
# res_df[i,6] = as.character(reslist_n_rep[[i]]$rf_res$target_one)
#
res_df[i,4] = as.character(reslist_n_rep[[i]]$elastic_res$prediction_one)
res_df[i,5] = as.character(reslist_n_rep[[i]]$rf_res$target_one)
RF_df[i,] = reslist_n_rep[[i]]$rf_res$best_mtry
elastic_df[i,] = reslist_n_rep[[i]]$elastic_res$best_l1_l2
}
note <- reslist_n_rep$note
reslist_n_rep$note = NULL
note
res_df = data.frame(RF = character(), better_prob = character(), equal_worse_prob = character(),
Elastic = character(), Target = character())
RF_df = data.frame(mtry = character(), split = character(), min_node = character())
elastic_df = data.frame(alpha = character(), lambda = character())
load("~/Dropbox/PostDoc/Karolinska/Sapient/Results/future_prediction_2025-11-03-13-57.RData")
note <- reslist_n_rep$note
reslist_n_rep$note = NULL
note
res_df = data.frame(RF = character(), better_prob = character(), equal_worse_prob = character(),
Elastic = character(), Target = character())
RF_df = data.frame(mtry = character(), split = character(), min_node = character())
elastic_df = data.frame(alpha = character(), lambda = character())
i=1
reslist_n_rep[[15]]$rf_res$best_mtry
reslist_n_rep[[15]]$rf_res$probabilities_one
reslist_n_rep[[i]]$elastic_res$best_l1_l2
# a = (caret::varImp(rf_res$model))
# imp_df = a$importance
# setwd("~/Downloads")
# write.csv(imp_df, file='metabolites_imp_all.csv')
#setwd("~/Documents/1) Postdoc data/Karolinska/Sapient")
#final_df = read.csv('8m_rlc_imputted_rows.csv')
pfun <- function(object, newdata) {
predict(object, newdata = newdata, type = "prob")[,1] # prob of first class
}
# Approximate SHAP values (nsim controls accuracy vs. speed)
shap_values <- fastshap::explain(rf_res$model, X = df, pred_wrapper = pfun, nsim = 100)
# Variable importance = mean absolute SHAP
shap_importance <- sort(colMeans(abs(shap_values)), decreasing = TRUE)
for (i in 1:length(reslist_n_rep)){
res_df[i,1] = as.character(reslist_n_rep[[i]]$rf_res$prediction_one)
res_df[i,2] = as.character(reslist_n_rep[[i]]$rf_res$probabilities_one$Better)
res_df[i,3] = as.character(reslist_n_rep[[i]]$rf_res$probabilities_one$Equal.Worse)
# res_df[i,2] = as.character(reslist_n_rep[[i]]$rf_res$probabilities_one$Mild)
# res_df[i,3] = as.character(reslist_n_rep[[i]]$rf_res$probabilities_one$Moderate)
# res_df[i,4] = as.character(reslist_n_rep[[i]]$rf_res$probabilities_one$Severe)
# res_df[i,5] = as.character(reslist_n_rep[[i]]$elastic_res$prediction_one)
# res_df[i,6] = as.character(reslist_n_rep[[i]]$rf_res$target_one)
#
res_df[i,4] = as.character(reslist_n_rep[[i]]$elastic_res$prediction_one)
res_df[i,5] = as.character(reslist_n_rep[[i]]$rf_res$target_one)
RF_df[i,] = reslist_n_rep[[i]]$rf_res$best_mtry
elastic_df[i,] = reslist_n_rep[[i]]$elastic_res$best_l1_l2
}
table(res_df$RF, res_df$Target)
table(res_df$Elastic, res_df$Target)
table(res_df$Elastic, res_df$RF)
note
MLmetrics::Accuracy(res_df$RF,res_df$Target)
MLmetrics::F1_Score(res_df$RF,res_df$Target)
mltools::mcc(res_df$RF,res_df$Target)
load("~/Dropbox/PostDoc/Karolinska/Sapient/Results/future_prediction_2025-11-03-14-30.RData")
note <- reslist_n_rep$note
reslist_n_rep$note = NULL
note
res_df = data.frame(RF = character(), better_prob = character(), equal_worse_prob = character(),
Elastic = character(), Target = character())
RF_df = data.frame(mtry = character(), split = character(), min_node = character())
elastic_df = data.frame(alpha = character(), lambda = character())
i=1
reslist_n_rep[[15]]$rf_res$best_mtry
reslist_n_rep[[15]]$rf_res$probabilities_one
reslist_n_rep[[i]]$elastic_res$best_l1_l2
# a = (caret::varImp(rf_res$model))
# imp_df = a$importance
# setwd("~/Downloads")
# write.csv(imp_df, file='metabolites_imp_all.csv')
#setwd("~/Documents/1) Postdoc data/Karolinska/Sapient")
#final_df = read.csv('8m_rlc_imputted_rows.csv')
pfun <- function(object, newdata) {
predict(object, newdata = newdata, type = "prob")[,1] # prob of first class
}
# Approximate SHAP values (nsim controls accuracy vs. speed)
shap_values <- fastshap::explain(rf_res$model, X = df, pred_wrapper = pfun, nsim = 100)
# Variable importance = mean absolute SHAP
shap_importance <- sort(colMeans(abs(shap_values)), decreasing = TRUE)
for (i in 1:length(reslist_n_rep)){
res_df[i,1] = as.character(reslist_n_rep[[i]]$rf_res$prediction_one)
res_df[i,2] = as.character(reslist_n_rep[[i]]$rf_res$probabilities_one$Better)
res_df[i,3] = as.character(reslist_n_rep[[i]]$rf_res$probabilities_one$Equal.Worse)
# res_df[i,2] = as.character(reslist_n_rep[[i]]$rf_res$probabilities_one$Mild)
# res_df[i,3] = as.character(reslist_n_rep[[i]]$rf_res$probabilities_one$Moderate)
# res_df[i,4] = as.character(reslist_n_rep[[i]]$rf_res$probabilities_one$Severe)
# res_df[i,5] = as.character(reslist_n_rep[[i]]$elastic_res$prediction_one)
# res_df[i,6] = as.character(reslist_n_rep[[i]]$rf_res$target_one)
#
res_df[i,4] = as.character(reslist_n_rep[[i]]$elastic_res$prediction_one)
res_df[i,5] = as.character(reslist_n_rep[[i]]$rf_res$target_one)
RF_df[i,] = reslist_n_rep[[i]]$rf_res$best_mtry
elastic_df[i,] = reslist_n_rep[[i]]$elastic_res$best_l1_l2
}
table(res_df$RF, res_df$Target)
table(res_df$Elastic, res_df$Target)
table(res_df$Elastic, res_df$RF)
note
MLmetrics::Accuracy(res_df$RF,res_df$Target)
load("~/Dropbox/PostDoc/Karolinska/Sapient/Results/future_prediction_2025-11-03-15-18.RData")
note <- reslist_n_rep$note
reslist_n_rep$note = NULL
note
res_df = data.frame(RF = character(), better_prob = character(), equal_worse_prob = character(),
Elastic = character(), Target = character())
RF_df = data.frame(mtry = character(), split = character(), min_node = character())
elastic_df = data.frame(alpha = character(), lambda = character())
i=1
reslist_n_rep[[15]]$rf_res$best_mtry
reslist_n_rep[[15]]$rf_res$probabilities_one
reslist_n_rep[[i]]$elastic_res$best_l1_l2
# a = (caret::varImp(rf_res$model))
# imp_df = a$importance
# setwd("~/Downloads")
# write.csv(imp_df, file='metabolites_imp_all.csv')
#setwd("~/Documents/1) Postdoc data/Karolinska/Sapient")
#final_df = read.csv('8m_rlc_imputted_rows.csv')
pfun <- function(object, newdata) {
predict(object, newdata = newdata, type = "prob")[,1] # prob of first class
}
# Approximate SHAP values (nsim controls accuracy vs. speed)
shap_values <- fastshap::explain(rf_res$model, X = df, pred_wrapper = pfun, nsim = 100)
# Variable importance = mean absolute SHAP
shap_importance <- sort(colMeans(abs(shap_values)), decreasing = TRUE)
for (i in 1:length(reslist_n_rep)){
res_df[i,1] = as.character(reslist_n_rep[[i]]$rf_res$prediction_one)
res_df[i,2] = as.character(reslist_n_rep[[i]]$rf_res$probabilities_one$Better)
res_df[i,3] = as.character(reslist_n_rep[[i]]$rf_res$probabilities_one$Equal.Worse)
# res_df[i,2] = as.character(reslist_n_rep[[i]]$rf_res$probabilities_one$Mild)
# res_df[i,3] = as.character(reslist_n_rep[[i]]$rf_res$probabilities_one$Moderate)
# res_df[i,4] = as.character(reslist_n_rep[[i]]$rf_res$probabilities_one$Severe)
# res_df[i,5] = as.character(reslist_n_rep[[i]]$elastic_res$prediction_one)
# res_df[i,6] = as.character(reslist_n_rep[[i]]$rf_res$target_one)
#
res_df[i,4] = as.character(reslist_n_rep[[i]]$elastic_res$prediction_one)
res_df[i,5] = as.character(reslist_n_rep[[i]]$rf_res$target_one)
RF_df[i,] = reslist_n_rep[[i]]$rf_res$best_mtry
elastic_df[i,] = reslist_n_rep[[i]]$elastic_res$best_l1_l2
}
table(res_df$RF, res_df$Target)
table(res_df$Elastic, res_df$Target)
table(res_df$Elastic, res_df$RF)
note
MLmetrics::Accuracy(res_df$RF,res_df$Target)
MLmetrics::F1_Score(res_df$RF,res_df$Target)
mltools::mcc(res_df$RF,res_df$Target)
load("~/Dropbox/PostDoc/Karolinska/Sapient/Results/future_prediction_2025-11-03-15-23.RData")
setwd("~/Dropbox/Postdoc/Karolinska/Sapient/Results")
note <- reslist_n_rep$note
reslist_n_rep$note = NULL
note
res_df = data.frame(RF = character(), better_prob = character(), equal_worse_prob = character(),
Elastic = character(), Target = character())
RF_df = data.frame(mtry = character(), split = character(), min_node = character())
elastic_df = data.frame(alpha = character(), lambda = character())
i=1
reslist_n_rep[[15]]$rf_res$best_mtry
reslist_n_rep[[15]]$rf_res$probabilities_one
reslist_n_rep[[i]]$elastic_res$best_l1_l2
# a = (caret::varImp(rf_res$model))
# imp_df = a$importance
# setwd("~/Downloads")
# write.csv(imp_df, file='metabolites_imp_all.csv')
#setwd("~/Documents/1) Postdoc data/Karolinska/Sapient")
#final_df = read.csv('8m_rlc_imputted_rows.csv')
pfun <- function(object, newdata) {
predict(object, newdata = newdata, type = "prob")[,1] # prob of first class
}
# Approximate SHAP values (nsim controls accuracy vs. speed)
shap_values <- fastshap::explain(rf_res$model, X = df, pred_wrapper = pfun, nsim = 100)
# Variable importance = mean absolute SHAP
shap_importance <- sort(colMeans(abs(shap_values)), decreasing = TRUE)
for (i in 1:length(reslist_n_rep)){
res_df[i,1] = as.character(reslist_n_rep[[i]]$rf_res$prediction_one)
res_df[i,2] = as.character(reslist_n_rep[[i]]$rf_res$probabilities_one$Better)
res_df[i,3] = as.character(reslist_n_rep[[i]]$rf_res$probabilities_one$Equal.Worse)
# res_df[i,2] = as.character(reslist_n_rep[[i]]$rf_res$probabilities_one$Mild)
# res_df[i,3] = as.character(reslist_n_rep[[i]]$rf_res$probabilities_one$Moderate)
# res_df[i,4] = as.character(reslist_n_rep[[i]]$rf_res$probabilities_one$Severe)
# res_df[i,5] = as.character(reslist_n_rep[[i]]$elastic_res$prediction_one)
# res_df[i,6] = as.character(reslist_n_rep[[i]]$rf_res$target_one)
#
res_df[i,4] = as.character(reslist_n_rep[[i]]$elastic_res$prediction_one)
res_df[i,5] = as.character(reslist_n_rep[[i]]$rf_res$target_one)
RF_df[i,] = reslist_n_rep[[i]]$rf_res$best_mtry
elastic_df[i,] = reslist_n_rep[[i]]$elastic_res$best_l1_l2
}
table(res_df$RF, res_df$Target)
table(res_df$Elastic, res_df$Target)
table(res_df$Elastic, res_df$RF)
note
MLmetrics::Accuracy(res_df$RF,res_df$Target)
MLmetrics::F1_Score(res_df$RF,res_df$Target)
mltools::mcc(res_df$RF,res_df$Target)
MLmetrics::Accuracy(res_df$Elastic,res_df$Target)
MLmetrics::F1_Score(res_df$Elastic,res_df$Target)
mltools::mcc(res_df$Elastic,res_df$Target)
note
MLmetrics::Accuracy(res_df$RF,res_df$Target)
load("~/Dropbox/PostDoc/Karolinska/Sapient/Results/future_prediction_2025-11-03-16-12.RData")
setwd("~/Dropbox/Postdoc/Karolinska/Sapient/Results")
note <- reslist_n_rep$note
reslist_n_rep$note = NULL
note
res_df = data.frame(RF = character(), better_prob = character(), equal_worse_prob = character(),
Elastic = character(), Target = character())
RF_df = data.frame(mtry = character(), split = character(), min_node = character())
elastic_df = data.frame(alpha = character(), lambda = character())
i=1
reslist_n_rep[[15]]$rf_res$best_mtry
reslist_n_rep[[15]]$rf_res$probabilities_one
reslist_n_rep[[i]]$elastic_res$best_l1_l2
# a = (caret::varImp(rf_res$model))
# imp_df = a$importance
# setwd("~/Downloads")
# write.csv(imp_df, file='metabolites_imp_all.csv')
#setwd("~/Documents/1) Postdoc data/Karolinska/Sapient")
#final_df = read.csv('8m_rlc_imputted_rows.csv')
pfun <- function(object, newdata) {
predict(object, newdata = newdata, type = "prob")[,1] # prob of first class
}
# Approximate SHAP values (nsim controls accuracy vs. speed)
shap_values <- fastshap::explain(rf_res$model, X = df, pred_wrapper = pfun, nsim = 100)
# Variable importance = mean absolute SHAP
shap_importance <- sort(colMeans(abs(shap_values)), decreasing = TRUE)
for (i in 1:length(reslist_n_rep)){
res_df[i,1] = as.character(reslist_n_rep[[i]]$rf_res$prediction_one)
res_df[i,2] = as.character(reslist_n_rep[[i]]$rf_res$probabilities_one$Better)
res_df[i,3] = as.character(reslist_n_rep[[i]]$rf_res$probabilities_one$Equal.Worse)
# res_df[i,2] = as.character(reslist_n_rep[[i]]$rf_res$probabilities_one$Mild)
# res_df[i,3] = as.character(reslist_n_rep[[i]]$rf_res$probabilities_one$Moderate)
# res_df[i,4] = as.character(reslist_n_rep[[i]]$rf_res$probabilities_one$Severe)
# res_df[i,5] = as.character(reslist_n_rep[[i]]$elastic_res$prediction_one)
# res_df[i,6] = as.character(reslist_n_rep[[i]]$rf_res$target_one)
#
res_df[i,4] = as.character(reslist_n_rep[[i]]$elastic_res$prediction_one)
res_df[i,5] = as.character(reslist_n_rep[[i]]$rf_res$target_one)
RF_df[i,] = reslist_n_rep[[i]]$rf_res$best_mtry
elastic_df[i,] = reslist_n_rep[[i]]$elastic_res$best_l1_l2
}
table(res_df$RF, res_df$Target)
table(res_df$Elastic, res_df$Target)
table(res_df$Elastic, res_df$RF)
note
MLmetrics::Accuracy(res_df$RF,res_df$Target)
load("~/Dropbox/PostDoc/Karolinska/Sapient/Results/future_prediction_2025-10-31-13-13.RData")
note <- reslist_n_rep$note
reslist_n_rep$note = NULL
note
setwd("~/Dropbox/PostDoc/Pisa")
setwd("~/Dropbox/PostDoc/Pisa")
df20222 = read.csv("data/df2022.csv")
names(df20222)
head(df20222)
unique(df20222$CNT)
df20222_filtered  = df20222[df20222$CNT %in% c("ARG", "AUS", "BRA", "POL","QAT" ,"SWE" ,"USA"),]
df20222_filtered  = df20222[df20222$CNT %in% c("ARG", "AUS", "BRA", "KOR","JAP","ESP", "FIN","MEX",
"POL","QAT" ,"SWE" ,"USA"),]
?
write.csv
df20222_filtered  = df20222[df20222$CNT %in% c("ARG", "AUS", "BRA", "KOR","JAP","ESP", "FIN","MEX",
"POL","QAT" ,"SWE" ,"USA"),]
write.csv(df20222_filtered,'data/df20222_filtered.csv', row.names = FALSE)
write.csv(df20222,'data/df20222_2.csv', row.names = FALSE)
